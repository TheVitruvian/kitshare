-require 'json'

.main-image
  .centre-opacity
    .row.collapse
      .large-3.columns.header-padding
        .panel.radius.callout
          .profile-top
            -if @user.role.present?
              %h4=@user.role
            -if @user == current_user
              %p="Welcome back #{@user.first_name}"
            .profile-img
              -if @user.profile_picture.present?
                = image_tag @user.profile_picture
              -else
                = image_tag "placeholder.png"
            = @user.user_name
          %hr
          .row.profile
          
            .label.radius Reply %: 
            
            .progress
              %span.meter{:style => "width: #{@user.replies_percentage}%"}
            .label.radius Rating:
            %span#user-rating.rating-width
              #user-score
                = @user.rating
          .row.profile
            -if @user.last_3_endorsements.present?
              .label.radius= "#{@user.user_name}'s endorsements:"
              %br
              - JSON.parse(@user.last_3_endorsements).each do |e|
                = e["rating"]
                = e["title"]
                = e["content"]
                %br
            -else
              ="#{@user.user_name} has no endorsements yet"
          
          .row.profile
            .label.radius Has insurance:
            = check_box_tag "" , "" , @user.insurance_end.future? , disabled: true
          -if @user != current_user
            %hr
            .label.radius="Rented off #{@user.first_name}? Rate them!"
            =form_for [@user, @user.endorsements.build] do |f|
              #given-rating.text-center
              = f.hidden_field :rating, id: "rating", disabled: true
              = f.text_field :title, placeholder: "Title...(extra points for puns)"
              = f.text_area :content, placeholder: "E.g.'#{@user.first_name} was an utter legend!'", size: "30"
              = f.submit "Rate", class: "button radius expand", id: "rate"
      


      .large-8.columns.header-padding
        %dl.sub-nav
          %dt Filter:
          %dd.active=link_to "All", "#"
          %dd= link_to "Skiing", "#"

        .profile
          .row
            .columns
              -@kits.each do |kit|
                .kits
                  .large-3.columns
                    .profile-img
                      -if kit.photo1.present?
                        = kit.photo1
                      -else
                        = image_tag "logo.png" 
                  .large-2.columns
                    .label.radius.secondary.text-center
                      =kit.category
                    .label.radius.secondary.text-center
                      =kit.kind
                    -if kit.sub_kind.present?
                      .label.radius.secondary.text-center
                        =kit.sub_kind 

                  .large-7.columns
                    %h5=link_to "#{kit.title}", kit
                    %p= kit.description
                %hr

        

  
  :javascript
    $('#user-rating').raty({ readOnly: true, score: parseFloat($('#user-score').text()) , path: '/assets' });
    $('#user-score').hide();
  
  :javascript
    $('#given-rating').raty({half: true, scoreName: 'endorsement[rating]', path: '/assets'})

  :javascript
    $('#new_endorsement').submit(function(){
      $('#rating').val(($('#given-rating').raty('score')));
    });

  




